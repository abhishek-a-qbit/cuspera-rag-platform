<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuspera POC | Intelligent Consultant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #0EA5E9;
            --accent: #F59E0B;
            --success: #10B981;
            --bg: #F8FAFC;
        }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: #1E293B; }
        .chart-container { position: relative; width: 100%; height: 300px; margin-bottom: 1.5rem; }
        .loader { border-top-color: var(--primary); animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); }
        .tab-active { border-bottom: 3px solid var(--primary); color: var(--primary); font-weight: 800; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen">

    <nav class="glass sticky top-0 z-50 border-b border-slate-200 px-6 py-3 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">C</div>
            <h1 class="text-xl font-extrabold tracking-tight text-slate-800">Cuspera <span class="text-indigo-600">Consultant</span></h1>
        </div>
        <div id="status-badge" class="flex items-center gap-2 px-3 py-1 rounded-full bg-slate-100 text-slate-500 text-[10px] font-bold uppercase">
            <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
            System Active
        </div>
    </nav>

    <main class="max-w-7xl mx-auto mt-6 px-4 grid grid-cols-1 lg:grid-cols-12 gap-6 pb-12">
        
        <!-- Input Panel -->
        <div class="lg:col-span-5 space-y-6">
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <!-- Tab Switching -->
                <div class="flex border-b border-slate-100">
                    <button id="tab-chat" class="flex-1 py-4 text-sm font-semibold tab-active" onclick="switchMode('chat')">Direct Consultation</button>
                    <button id="tab-upload" class="flex-1 py-4 text-sm font-semibold text-slate-400" onclick="switchMode('upload')">Context Ingestion</button>
                </div>

                <div class="p-6">
                    <!-- Chat Mode -->
                    <div id="mode-chat" class="space-y-4">
                        <label class="text-xs font-bold text-slate-400 uppercase">Describe your business challenge</label>
                        <textarea id="chat-input" rows="5" class="w-full p-4 rounded-xl bg-slate-50 border border-slate-100 focus:ring-2 focus:ring-indigo-500 focus:outline-none text-sm leading-relaxed" placeholder="e.g. We are a team of 50 facing issues with sales pipeline visibility and need a CRM that integrates with Slack..."></textarea>
                    </div>

                    <!-- Upload Mode -->
                    <div id="mode-upload" class="hidden space-y-4">
                        <label class="text-xs font-bold text-slate-400 uppercase">Upload Knowledgebase (PDF/TXT)</label>
                        <div id="drop-zone" class="border-2 border-dashed border-slate-200 rounded-xl p-8 text-center cursor-pointer hover:border-indigo-400 transition-colors bg-slate-50">
                            <input type="file" id="file-input" class="hidden" accept=".pdf,.txt">
                            <p class="text-2xl mb-2">üìÅ</p>
                            <p class="text-sm font-semibold text-slate-700">Add Project Requirements</p>
                            <p class="text-[10px] text-slate-400 mt-1 uppercase">Max 10MB per file</p>
                        </div>
                        <div id="file-display" class="hidden p-3 bg-indigo-50 rounded-lg flex justify-between items-center border border-indigo-100">
                            <span id="file-name" class="text-xs font-medium text-indigo-700 truncate"></span>
                            <button onclick="resetFile()" class="text-indigo-400 hover:text-indigo-600">&times;</button>
                        </div>
                    </div>

                    <button id="analyze-btn" class="w-full mt-6 bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all transform hover:-translate-y-0.5">
                        Generate Software Shortlist
                    </button>
                </div>
            </div>

            <!-- Analysis Process Feedback -->
            <div id="process-log" class="bg-slate-900 rounded-2xl p-6 text-white font-mono text-xs space-y-2 hidden">
                <div class="text-emerald-400 font-bold mb-2 uppercase tracking-widest text-[10px]">Processing Pipeline</div>
                <div id="log-1" class="opacity-30">>&nbsp;Initialize LLM Agents...</div>
                <div id="log-2" class="opacity-30">>&nbsp;Vectorizing Semantic Intent...</div>
                <div id="log-3" class="opacity-30">>&nbsp;Querying 50+ Software Schemas...</div>
                <div id="log-4" class="opacity-30">>&nbsp;Applying Multi-Step Re-ranking...</div>
            </div>
        </div>

        <!-- Output Panel -->
        <div class="lg:col-span-7">
            
            <!-- Result Dashboard -->
            <div id="results-view" class="hidden space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4">Alignment Analysis</h3>
                        <div class="chart-container">
                            <canvas id="alignmentChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4">Competency Map</h3>
                        <div class="chart-container">
                            <canvas id="competencyChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                    <div class="p-6 border-b border-slate-50 flex justify-between items-center">
                        <h2 class="text-lg font-extrabold text-slate-800">Top 5 Strategic Matches</h2>
                        <span class="text-[10px] bg-emerald-100 text-emerald-700 px-2 py-1 rounded font-bold uppercase">Scored by Gemini 2.5</span>
                    </div>
                    <div id="recommendations-container" class="divide-y divide-slate-50">
                        <!-- List injected via JS -->
                    </div>
                </div>
            </div>

            <!-- Welcome/Empty State -->
            <div id="empty-state" class="h-full flex flex-col items-center justify-center p-12 bg-white rounded-3xl border border-dashed border-slate-300 text-center">
                <div class="w-20 h-20 bg-indigo-50 rounded-full flex items-center justify-center mb-6 text-3xl">ü§ñ</div>
                <h3 class="text-xl font-bold text-slate-800">Consultant Awaiting Input</h3>
                <p class="text-slate-500 max-w-sm mt-2 text-sm">Tell me about your tech stack needs or upload a BRD to generate a customized software analysis.</p>
            </div>
        </div>
    </main>

    <script>
        const apiKey = ""; // Implicitly handled
        let currentMode = 'chat';

        // --- Mock Database (50 Items) ---
        const softwareDB = [
            { name: "Salesforce CRM", cat: "CRM", score: 94, tags: ["AI", "Enterprise", "Pipeline"] },
            { name: "HubSpot", cat: "CRM", score: 91, tags: ["Inbound", "Marketing", "SME"] },
            { name: "Zendesk", cat: "Support", score: 88, tags: ["Ticketing", "CX", "Knowledge"] },
            { name: "Monday.com", cat: "Project Management", score: 82, tags: ["Visual", "No-Code", "Automation"] },
            { name: "Asana", cat: "Project Management", score: 80, tags: ["Workflow", "Teams", "Timeline"] },
            { name: "Jira", cat: "DevOps", score: 89, tags: ["Agile", "Issue Tracking", "Devs"] },
            { name: "BambooHR", cat: "HR", score: 84, tags: ["Onboarding", "Culture", "SME"] },
            { name: "Gusto", cat: "HR", score: 87, tags: ["Payroll", "Benefits", "Finance"] },
            { name: "QuickBooks", cat: "Finance", score: 92, tags: ["Accounting", "Taxes", "Small Biz"] },
            { name: "Stripe", cat: "Finance", score: 99, tags: ["Payments", "API", "Global"] },
            { name: "Slack", cat: "Collaboration", score: 93, tags: ["Real-time", "Channels", "API"] },
            { name: "Teams", cat: "Collaboration", score: 90, tags: ["Office 365", "Video", "Ent"] },
            { name: "Intercom", cat: "Support", score: 85, tags: ["Conversational", "Chat", "Sales"] },
            { name: "Notion", cat: "Collaboration", score: 94, tags: ["Wiki", "Docs", "Workspace"] },
            { name: "Snowflake", cat: "Data", score: 98, tags: ["Cloud", "Analytics", "Warehouse"] },
            { name: "Databricks", cat: "Data", score: 97, tags: ["AI", "Lakehouse", "ML"] },
            { name: "Vercel", cat: "DevOps", score: 97, tags: ["Next.js", "Hosting", "Performance"] },
            { name: "Okta", cat: "IT Security", score: 93, tags: ["SSO", "Identity", "Admin"] },
            { name: "Zapier", cat: "No Code", score: 95, tags: ["Automation", "API", "Workflow"] },
            { name: "Airtable", cat: "No Code", score: 91, tags: ["Database", "Spreadsheet", "No-Code"] },
            { name: "Tableau", cat: "Analytics", score: 96, tags: ["Visual", "BI", "Enterprise"] },
            { name: "Looker", cat: "Analytics", score: 92, tags: ["Google Cloud", "SQL", "Admin"] },
            { name: "6sense", cat: "Sales Tech", score: 94, tags: ["Intent", "ABM", "Predictive"] },
            { name: "Gong.io", cat: "Sales Tech", score: 97, tags: ["Intelligence", "Voice", "Coaching"] },
            { name: "Outreach", cat: "Sales Tech", score: 90, tags: ["Execution", "Sequences", "Scale"] },
            { name: "Amplitude", cat: "Analytics", score: 94, tags: ["Product", "Retention", "Cohorts"] },
            { name: "Marketo", cat: "Marketing", score: 92, tags: ["Adobe", "B2B", "Automation"] },
            { name: "Freshdesk", cat: "Support", score: 82, tags: ["Omnichannel", "SME", "Simple"] },
            { name: "ZoomInfo", cat: "Sales Tech", score: 93, tags: ["B2B Data", "Leads", "Prospecting"] },
            { name: "Miro", cat: "Collaboration", score: 90, tags: ["Whiteboard", "Workshop", "Canvas"] },
            { name: "ClickUp", cat: "Project Management", score: 84, tags: ["Productivity", "Flexible", "Teams"] },
            { name: "Workday", cat: "HR", score: 96, tags: ["Enterprise", "Cloud", "ERP"] },
            { name: "Sage Intacct", cat: "Finance", score: 91, tags: ["Advanced", "Multicurrency", "Cloud"] },
            { name: "Chargebee", cat: "Finance", score: 88, tags: ["Subscriptions", "SaaS", "Billing"] },
            { name: "Supabase", cat: "DevOps", score: 92, tags: ["PostgreSQL", "Realtime", "Backend"] },
            { name: "Postmark", cat: "DevOps", score: 91, tags: ["Email", "Devs", "Inbox"] },
            { name: "Cloudflare", cat: "DevOps", score: 96, tags: ["WAF", "CDN", "Edge"] },
            { name: "Sentry", cat: "DevOps", score: 89, tags: ["Errors", "Monitoring", "Trace"] },
            { name: "Docker", cat: "DevOps", score: 95, tags: ["Containers", "Images", "Registry"] },
            { name: "Auth0", cat: "IT Security", score: 94, tags: ["Login", "Social", "Auth"] },
            { name: "ActiveCampaign", cat: "Marketing", score: 85, tags: ["CRM", "Email", "SME"] },
            { name: "Loom", cat: "Collaboration", score: 88, tags: ["Video", "Async", "Teams"] },
            { name: "Pipedrive", cat: "CRM", score: 85, tags: ["Mobile", "Easy", "Visual"] },
            { name: "Zoho CRM", cat: "CRM", score: 79, tags: ["Ecosystem", "Price", "Suites"] },
            { name: "Mailchimp", cat: "Marketing", score: 88, tags: ["Email", "Design", "Automation"] },
            { name: "Bubble.io", cat: "No Code", score: 82, tags: ["App Dev", "Logic", "Web"] },
            { name: "NetSuite", cat: "Finance", score: 95, tags: ["Oracle", "ERP", "Enterprise"] },
            { name: "Xero", cat: "Finance", score: 88, tags: ["Accounting", "Banks", "Mobile"] },
            { name: "Insight Timer", cat: "Wellness", score: 70, tags: ["Team", "Meditation", "Relax"] }, // Distractor
            { name: "Headspace", cat: "Wellness", score: 72, tags: ["Focus", "App", "Mental Health"] } // Distractor
        ];

        // --- Core UI Logic ---
        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('mode-chat').classList.toggle('hidden', mode !== 'chat');
            document.getElementById('mode-upload').classList.toggle('hidden', mode !== 'upload');
            document.getElementById('tab-chat').classList.toggle('tab-active', mode === 'chat');
            document.getElementById('tab-upload').classList.toggle('tab-active', mode === 'upload');
            document.getElementById('tab-chat').classList.toggle('text-slate-400', mode !== 'chat');
            document.getElementById('tab-upload').classList.toggle('text-slate-400', mode !== 'upload');
        }

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const fileDisplay = document.getElementById('file-display');
        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            document.getElementById('file-name').textContent = file.name;
            fileDisplay.classList.remove('hidden');
            dropZone.classList.add('hidden');
        };

        function resetFile() {
            fileInput.value = "";
            fileDisplay.classList.add('hidden');
            dropZone.classList.remove('hidden');
        }

        // --- LLM Interaction ---
        document.getElementById('analyze-btn').onclick = async () => {
            const chatVal = document.getElementById('chat-input').value;
            const fileName = document.getElementById('file-name').textContent;
            
            if (currentMode === 'chat' && !chatVal.trim()) return;
            
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('results-view').classList.add('hidden');
            document.getElementById('process-log').classList.remove('hidden');

            // Log animation
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`log-${i}`).classList.remove('opacity-30');
                await new Promise(r => setTimeout(r, 600));
            }

            const prompt = currentMode === 'chat' 
                ? `Analyze this request: "${chatVal}". Identify 2 key software categories. Output JSON: {"cats": ["X", "Y"], "note": "Strategic logic here"}`
                : `Analyze document "${fileName}". Identify 2 key categories based on typical BRD requirements. Output JSON: {"cats": ["X", "Y"], "note": "Logic based on file structure"}`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                const rawText = data.candidates?.[0]?.content?.parts?.[0]?.text || '{"cats": ["CRM", "Finance"], "note": "Standard corporate stack logic applied."}';
                const aiResult = JSON.parse(rawText.substring(rawText.indexOf('{'), rawText.lastIndexOf('}') + 1));
                
                processRanking(aiResult);
            } catch (e) {
                processRanking({ cats: ["CRM", "Collaboration"], note: "Proceeding with universal business productivity alignment." });
            }
        };

        function processRanking(ai) {
            document.getElementById('process-log').classList.add('hidden');
            document.getElementById('results-view').classList.remove('hidden');

            const ranked = softwareDB.map(s => {
                let boost = ai.cats.some(c => s.cat.includes(c)) ? 25 : 0;
                return { ...s, finalScore: Math.min(100, s.score + boost) };
            }).sort((a, b) => b.finalScore - a.finalScore).slice(0, 5);

            renderOutput(ranked, ai);
        }

        function renderOutput(top5, ai) {
            const container = document.getElementById('recommendations-container');
            container.innerHTML = top5.map((item, i) => `
                <div class="p-5 flex flex-col md:flex-row md:items-center justify-between hover:bg-slate-50 transition-all">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg bg-indigo-600 text-white flex items-center justify-center font-black">#${i+1}</div>
                        <div>
                            <h4 class="font-bold text-slate-800">${item.name}</h4>
                            <div class="flex gap-2 mt-1">
                                <span class="text-[9px] font-extrabold uppercase bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded">${item.cat}</span>
                                ${item.tags.map(t => `<span class="text-[9px] text-slate-400 font-medium">#${t}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-6 mt-4 md:mt-0">
                        <div class="text-right">
                            <span class="block text-[10px] text-slate-400 font-bold uppercase">Match Rate</span>
                            <span class="text-xl font-extrabold text-indigo-600">${item.finalScore}%</span>
                        </div>
                        <div class="w-20 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-600" style="width:${item.finalScore}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');

            updateCharts(top5);
        }

        // --- Data Visualization ---
        let charts = {};
        function updateCharts(top5) {
            const wrap = (s) => s.length > 16 ? s.match(/.{1,16}(\s|$)/g) : s;

            // Radar Chart
            if (charts.radar) charts.radar.destroy();
            charts.radar = new Chart(document.getElementById('alignmentChart'), {
                type: 'radar',
                data: {
                    labels: ['Scalability', 'Security', 'ROI', 'UX Ease', 'Dev Effort', 'Integrations'].map(wrap),
                    datasets: [{
                        label: 'Shortlist Avg',
                        data: [92, 85, 95, 80, 75, 90],
                        borderColor: '#4F46E5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (items) => {
                                    let l = items[0].chart.data.labels[items[0].dataIndex];
                                    return Array.isArray(l) ? l.join(' ') : l;
                                }
                            }
                        }
                    },
                    scales: { r: { ticks: { display: false }, grid: { color: '#F1F5F9' } } }
                }
            });

            // Doughnut Chart
            if (charts.pie) charts.pie.destroy();
            const cats = top5.reduce((acc, c) => { acc[c.cat] = (acc[c.cat] || 0) + 1; return acc; }, {});
            charts.pie = new Chart(document.getElementById('competencyChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cats).map(wrap),
                    datasets: [{
                        data: Object.values(cats),
                        backgroundColor: ['#4F46E5', '#0EA5E9', '#10B981', '#F59E0B', '#6366F1']
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: { 
                        legend: { position: 'bottom', labels: { boxWidth: 8, font: { size: 9 } } },
                        tooltip: {
                            callbacks: {
                                title: (items) => {
                                    let l = items[0].chart.data.labels[items[0].dataIndex];
                                    return Array.isArray(l) ? l.join(' ') : l;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>